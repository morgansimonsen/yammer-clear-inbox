<script type="text/javascript" data-app-id="xxxxxxxxxxxxx"
        src="https://assets.yammer.com/assets/platform_js_sdk.js"></script>
<script type="text/javascript"
        src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

<link href="https://c64.assets-yammer.com/assets/application-1c98c68e33b84c76a20d8b772a79d328.css" media="screen, projection, print" rel="stylesheet" type="text/css" />


<script type="text/javascript">

    var count = 1;

    function getUnreadCount() {

        yam.getLoginStatus( function(response) {

          if (response.authResponse) {
                var url = "https://api.yammer.com/api/v1/messages/inbox.json"; 

                yam.request(
                  { url: url
                  , method: "GET"
                  , data: {

                  }
                  , success: function (json) {
                            $('#columns').empty();
                            $('#columns').append("<div>Unread Count: "+ json.meta.unseen_thread_count +"</div>");
                            $('#columns').append('<div><a href="#" onclick="clearMessages()">Clear</a></div>');                  }
                  , error: function (msg) { }
                  }
                );
            } else {
                yam.login( function (response) {
                   //nothing
                });
            }
        });
    }


    function clearMessages(p) {

          yam.getLoginStatus( function(response) {

          if (response.authResponse) {
                var url = "https://api.yammer.com/api/v1/messages/inbox.json"; //joined

                yam.request(
                  { url: url
                  , method: "GET"
                  , data: {
                         page: p
                  }
                  , success: function (json) {
                      $.each(json.meta.unseen_message_count_by_thread, function(index, element) {
                            if (element != 0) {
                                $('#columns').append("<div>"+ count++ + ". " + index + " " + element +" clearing....</div>");
                                readMessage(index);
                            }
                      });
                  }
                  , error: function (msg) { }
                  }
                );
            } else {
                yam.login( function (response) {
                   //nothing
                });
            }

        });
    }

    function readMessage(threadId) {
            var url = "https://api.yammer.com/api/v1/messages/last_seen_in_thread.json";

            yam.request(
              { url: url
              , method: "GET"
              , data: {
                    thread_id: threadId
              }
              , success: function (ret) {

              }
              , error: function (msg) { }
              }
            );
    }


</script>


<div class="header-cell" id="masthead-container">
    <h1>Clear Out Your Yammer Inbox</h1>
</div>

<body onload="getUnreadCount()">

<div id="wrapper">
    <div id="columns">
        checking...
        <!-- this is where the data gets loaded -->
    </div>

</div>

</body>
